TODO:
- Revert changes so that it only supports single subjects
- Tidy up and optimise